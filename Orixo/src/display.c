
#include "display.h"

uint16_t gfx_pal[PAL_LENGTH];

uint8_t sprite_case_blocked[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

uint8_t sprite_case_used[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_case_empty[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_case_1[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x04,0x02,0x02,0x02,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_case_2[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x06,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x06,0x02,0x06,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x06,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x06,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x06,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x06,0x06,0x06,0x02,0x02,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_case_3[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x05,0x05,0x05,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x05,0x02,0x01,
        0x01,0x02,0x02,0x02,0x05,0x05,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x05,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x05,0x02,0x01,
        0x01,0x02,0x02,0x05,0x05,0x05,0x02,0x02,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_case_4[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x08,0x02,0x08,0x02,0x02,0x01,
        0x01,0x02,0x02,0x08,0x02,0x08,0x02,0x02,0x01,
        0x01,0x02,0x02,0x08,0x08,0x08,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x08,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x08,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x08,0x02,0x02,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_case_5[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x09,0x09,0x09,0x09,0x02,0x01,
        0x01,0x02,0x02,0x09,0x02,0x02,0x02,0x02,0x01,
        0x01,0x02,0x02,0x09,0x09,0x09,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x09,0x02,0x01,
        0x01,0x02,0x02,0x09,0x09,0x09,0x02,0x02,0x01,
        0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x01,
        0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
};

uint8_t sprite_cursor_move[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,
};

uint8_t sprite_cursor_place[CASE_SIZE] = {
        CASE_X_LENGTH,
        CASE_Y_LENGTH,
        0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,
        0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x04,
        0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,
        0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,
};

gfx_sprite_t* CASE_TAB[8] = {
        SPRITE_CASE_BLOCKED,
        SPRITE_CASE_USED,
        SPRITE_CASE_EMPTY,
        SPRITE_CASE_1,
        SPRITE_CASE_2,
        SPRITE_CASE_3,
        SPRITE_CASE_4,
        SPRITE_CASE_5,
};

void printText(char *text, uint8_t length, uint8_t x, uint8_t y) {
    gfx_FillRectangle(x, y, CHAR_LENGTH * length, CHAR_LENGTH);
    gfx_PrintStringXY(text, x, y);
}

void printUint(uint8_t number, uint8_t length, uint8_t x, uint8_t y) {
    gfx_FillRectangle(x, y, CHAR_LENGTH * length, CHAR_LENGTH);
    gfx_SetTextXY(x, y);
    gfx_PrintUInt(number, length);
}

void defPal() {
    uint8_t i;

    gfx_pal[0] = gfx_RGBTo1555(  0,  0,  0);     // transparent
    gfx_pal[1] = gfx_RGBTo1555(250,250,250);     // white
    gfx_pal[2] = gfx_RGBTo1555(200,200,200);     // light grey
    gfx_pal[3] = gfx_RGBTo1555(150,150,150);     // grey
    gfx_pal[4] = gfx_RGBTo1555(  0,  0,  0);     // black
    gfx_pal[5] = gfx_RGBTo1555(180,  0,  0);     // red
    gfx_pal[6] = gfx_RGBTo1555(  0,120,  0);     // green
    gfx_pal[7] = gfx_RGBTo1555(  0,  0,190);     // blue
    gfx_pal[8] = gfx_RGBTo1555(160,  0,160);     // magenta
    gfx_pal[9] = gfx_RGBTo1555(100,  0,  0);     // dark red

    for (i = 10; i < PAL_LENGTH; ++i) {
        gfx_pal[i] = gfx_RGBTo1555((1.5 * i) - 15, 0, 180);
    }
}

void gradian() {
    uint8_t color;

    for (color = 0; color < 120; ++color) {
        gfx_SetColor(129 - color);
        gfx_HorizLine(0, color * 2, 320);
        gfx_HorizLine(0, (color * 2) + 1, 320);
    }
}

void printCase(t_case matrix[MATRIX_X_MAX][MATRIX_Y_MAX], int8_t x, int8_t y) {
    gfx_TransparentSprite_NoClip(
            CASE_TAB[matrix[x][y].number + 2],
            CASE_X_LENGTH * (uint24_t)x + MARGE_X,
            CASE_Y_LENGTH * (uint8_t)y + MARGE_Y);
}

gfx_sprite_t* cursorState(uint8_t state) {
    if (state) {
        return SPRITE_CURSOR_PLACE;
    }
    return SPRITE_CURSOR_MOVE;
}

void printCursor(t_cursor cursor) {
    gfx_TransparentSprite_NoClip(
            cursorState(cursor.state),
            CASE_X_LENGTH * (uint24_t)cursor.pos.x + MARGE_X,
            CASE_Y_LENGTH * (uint8_t)cursor.pos.y + MARGE_Y);
}

void eraseCursor(t_game *game) {
    printCase(game->matrix, game->cursor.pos.x, game->cursor.pos.y);
}

void printMap(t_game *game) {
    int8_t i;
    int8_t j;

    gradian();
    for(i = 0; i < game->x_max; ++i) {
        for(j = 0; j < game->y_max; ++j) {
            printCase(game->matrix, i, j);
        }
    }
    printCursor(game->cursor);
}

void printDifficulty(uint8_t difficulty) {
    gfx_SetTextScale(2, 2);
    gfx_FillRectangle(170, 60, CHAR_LENGTH * 18, CHAR_LENGTH * 2);
    switch (difficulty) {
        case EASY:
            gfx_PrintStringXY("easy", 200, 60);
            break;
        case NORMAL:
            gfx_PrintStringXY("normal", 190, 60);
            break;
        case HARD:
            gfx_PrintStringXY("hard", 200, 60);
            break;
        case CUSTOMIZE:
            gfx_PrintStringXY("customize", 170, 60);
            break;
    }
    gfx_SetTextScale(1, 1);
}

void printCategory(t_pos *cursor_pos) {
    gfx_SetTextScale(2, 2);
    gfx_PrintStringXY("Difficulty :", 10, 60);
    gfx_SetTextScale(1, 1);
    gfx_PrintStringXY("Map X max :", 105, 100);
    gfx_PrintStringXY("Map Y max :", 105, 120);
    gfx_PrintStringXY("Amount of Numbers :", 70, 140);
    gfx_PrintStringXY("Number max :", 100, 160);

    gfx_SetTextFGColor(RED);
    switch (cursor_pos->y) {
        case 0:
            gfx_SetTextScale(2, 2);
            gfx_PrintStringXY("Difficulty :", 10, 60);
            gfx_SetTextScale(1, 1);
            break;
        case 1:
            gfx_PrintStringXY("Map X max :", 105, 100);
            break;
        case 2:
            gfx_PrintStringXY("Map Y max :", 105, 120);
            break;
        case 3:
            gfx_PrintStringXY("Amount of Numbers :", 70, 140);
            break;
        case 4:
            gfx_PrintStringXY("Number max :", 100, 160);
            break;
    }
    gfx_SetTextFGColor(LIGHT_GREY);
}

void printMenu(t_pos *cursor_pos) {
    printCategory(cursor_pos);

    switch (cursor_pos->y) {
        case 0:
            printDifficulty(cursor_pos->x);
            printUint(MENU[cursor_pos->x][1], 2, 180, 100);
            printUint(MENU[cursor_pos->x][2], 2, 180, 120);
            printUint(MENU[cursor_pos->x][3], 2, 210, 140);
            printUint(MENU[cursor_pos->x][4], 2, 190, 160);
            break;
        case 1:
            printUint(cursor_pos->x, 2, 180, 100);
            break;
        case 2:
            printUint(cursor_pos->x, 2, 180, 120);
            break;
        case 3:
            printUint(cursor_pos->x, 2, 210, 140);
            break;
        case 4:
            printUint(cursor_pos->x, 2, 190, 160);
            break;
    }
}